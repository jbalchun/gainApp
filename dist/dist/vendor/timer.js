var timerModule=angular.module("timer",[]).directive("timer",["$compile",function(t){return{restrict:"EA",replace:!1,scope:{interval:"=interval",startTimeAttr:"=startTime",endTimeAttr:"=endTime",countdownattr:"=countdown",finishCallback:"&finishCallback",autoStart:"&autoStart",maxTimeUnit:"="},controller:["$scope","$element","$attrs","$timeout","$interpolate",function(n,e,o,i,s){function r(){n.timeoutId&&clearTimeout(n.timeoutId)}function a(){void 0!==o.startTime&&(n.millis=new Date-new Date(n.startTimeAttr)),n.maxTimeUnit&&"day"!==n.maxTimeUnit?"second"===n.maxTimeUnit?(n.seconds=Math.floor(n.millis/1e3),n.minutes=0,n.hours=0,n.days=0,n.months=0,n.years=0):"minute"===n.maxTimeUnit?(n.seconds=Math.floor(n.millis/1e3%60),n.minutes=Math.floor(n.millis/6e4),n.hours=0,n.days=0,n.months=0,n.years=0):"hour"===n.maxTimeUnit?(n.seconds=Math.floor(n.millis/1e3%60),n.minutes=Math.floor(n.millis/6e4%60),n.hours=Math.floor(n.millis/36e5),n.days=0,n.months=0,n.years=0):"month"===n.maxTimeUnit?(n.seconds=Math.floor(n.millis/1e3%60),n.minutes=Math.floor(n.millis/6e4%60),n.hours=Math.floor(n.millis/36e5%24),n.days=Math.floor(n.millis/36e5/24%30),n.months=Math.floor(n.millis/36e5/24/30),n.years=0):"year"===n.maxTimeUnit&&(n.seconds=Math.floor(n.millis/1e3%60),n.minutes=Math.floor(n.millis/6e4%60),n.hours=Math.floor(n.millis/36e5%24),n.days=Math.floor(n.millis/36e5/24%30),n.months=Math.floor(n.millis/36e5/24/30%12),n.years=Math.floor(n.millis/36e5/24/365)):(n.seconds=Math.floor(n.millis/1e3%60),n.minutes=Math.floor(n.millis/6e4%60),n.hours=Math.floor(n.millis/36e5%24),n.days=Math.floor(n.millis/36e5/24),n.months=0,n.years=0),n.secondsS=1===n.seconds?"":"s",n.minutesS=1===n.minutes?"":"s",n.hoursS=1===n.hours?"":"s",n.daysS=1===n.days?"":"s",n.monthsS=1===n.months?"":"s",n.yearsS=1===n.years?"":"s",n.secondUnit=function(t,e){return 1===n.seconds?t?t:"second":e?e:"seconds"},n.minuteUnit=function(t,e){return 1===n.minutes?t?t:"minute":e?e:"minutes"},n.hourUnit=function(t,e){return 1===n.hours?t?t:"hour":e?e:"hours"},n.dayUnit=function(t,e){return 1===n.days?t?t:"day":e?e:"days"},n.monthUnit=function(t,e){return 1===n.months?t?t:"month":e?e:"months"},n.yearUnit=function(t,e){return 1===n.years?t?t:"year":e?e:"years"},n.sseconds=n.seconds<10?"0"+n.seconds:n.seconds,n.mminutes=n.minutes<10?"0"+n.minutes:n.minutes,n.hhours=n.hours<10?"0"+n.hours:n.hours,n.ddays=n.days<10?"0"+n.days:n.days,n.mmonths=n.months<10?"0"+n.months:n.months,n.yyears=n.years<10?"0"+n.years:n.years}"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),n.autoStart=o.autoStart||o.autostart,e.append(0===e.html().trim().length?t("<span>"+s.startSymbol()+"millis"+s.endSymbol()+"</span>")(n):t(e.contents())(n)),n.startTime=null,n.endTime=null,n.timeoutId=null,n.countdown=n.countdownattr&&parseInt(n.countdownattr,10)>=0?parseInt(n.countdownattr,10):void 0,n.isRunning=!1,n.$on("timer-start",function(){n.start()}),n.$on("timer-resume",function(){n.resume()}),n.$on("timer-stop",function(){n.stop()}),n.$on("timer-clear",function(){n.clear()}),n.$on("timer-reset",function(){n.reset()}),n.$on("timer-set-countdown",function(t,e){n.countdown=e}),n.$watch("startTimeAttr",function(t,e){t!==e&&n.isRunning&&n.start()}),n.start=e[0].start=function(){n.startTime=n.startTimeAttr?new Date(n.startTimeAttr):new Date,n.endTime=n.endTimeAttr?new Date(n.endTimeAttr):null,n.countdown||(n.countdown=n.countdownattr&&parseInt(n.countdownattr,10)>0?parseInt(n.countdownattr,10):void 0),r(),m(),n.isRunning=!0},n.resume=e[0].resume=function(){r(),n.countdownattr&&(n.countdown+=1),n.startTime=new Date-(n.stoppedTime-n.startTime),m(),n.isRunning=!0},n.stop=n.pause=e[0].stop=e[0].pause=function(){var t=n.timeoutId;n.clear(),n.$emit("timer-stopped",{timeoutId:t,millis:n.millis,seconds:n.seconds,minutes:n.minutes,hours:n.hours,days:n.days})},n.clear=e[0].clear=function(){n.stoppedTime=new Date,r(),n.timeoutId=null,n.isRunning=!1},n.reset=e[0].reset=function(){n.startTime=n.startTimeAttr?new Date(n.startTimeAttr):new Date,n.endTime=n.endTimeAttr?new Date(n.endTimeAttr):null,n.countdown=n.countdownattr&&parseInt(n.countdownattr,10)>0?parseInt(n.countdownattr,10):void 0,r(),m(),n.isRunning=!1,n.clear()},e.bind("$destroy",function(){r(),n.isRunning=!1}),n.countdownattr?(n.millis=1e3*n.countdownattr,n.addCDSeconds=e[0].addCDSeconds=function(t){n.countdown+=t,n.$digest(),n.isRunning||n.start()},n.$on("timer-add-cd-seconds",function(t,e){i(function(){n.addCDSeconds(e)})}),n.$on("timer-set-countdown-seconds",function(t,e){n.isRunning||n.clear(),n.countdown=e,n.millis=1e3*e,a()})):n.millis=0,a();var m=function(){n.millis=new Date-n.startTime;var t=n.millis%1e3;return n.endTimeAttr&&(n.millis=n.endTime-new Date,t=n.interval-n.millis%1e3),n.countdownattr&&(n.millis=1e3*n.countdown),n.millis<0?(n.stop(),n.millis=0,a(),void(n.finishCallback&&n.$eval(n.finishCallback))):(a(),n.timeoutId=setTimeout(function(){m(),n.$digest()},n.interval-t),n.$emit("timer-tick",{timeoutId:n.timeoutId,millis:n.millis}),void(n.countdown>0?n.countdown--:n.countdown<=0&&(n.stop(),n.finishCallback&&n.$eval(n.finishCallback))))};(void 0===n.autoStart||n.autoStart===!0)&&n.start()}]}}]);"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports=timerModule);