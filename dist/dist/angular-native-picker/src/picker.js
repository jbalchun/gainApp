!function(e){"function"==typeof define&&define.amd?define("picker",["angular"],e):this.Picker=e(angular)}(function(e){function t(e,o,r,i){function u(){return t._.node("div",t._.node("div",t._.node("div",t._.node("div",v.component.nodes(g.open),p.box),p.wrap),p.frame),p.holder)}function l(){m.data(o,v),m.addClass(p.input),m[0].value=m.attr("data-value")?v.get("select",f.format):e.value,angular.element(document.querySelectorAll("#"+g.id)).on("focus",s),angular.element(document.querySelectorAll("#"+g.id)).on("click",s),f.editable||angular.element(document.querySelectorAll("#"+g.id)).on("keydown",function(e){var t=e.keyCode,n=/^(8|46)$/.test(t);return 27==t?(v.close(),!1):void((32==t||n||!g.open&&v.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?v.clear().close():v.open()))}),n(e,{haspopup:!0,expanded:!1,readonly:!1,owns:e.id+"_root"+(v._hidden?" "+v._hidden.id:"")})}function d(){function o(){angular.element(v.$root[0].querySelectorAll("[data-pick], [data-nav], [data-clear]")).on("click",function(){var n=angular.element(this),r=n.hasClass(p.navDisabled)||n.hasClass(p.disabled),a=document.activeElement;a=a&&(a.type||a.href)&&a,(r||a&&!v.$root[0].contains(a))&&e.focus(),n.attr("data-nav")&&!r?(v.set("highlight",v.component.item.highlight,{nav:parseInt(n.attr("data-nav"))}),o()):t._.isInteger(parseInt(n.attr("data-pick")))&&!r?(v.set("select",parseInt(n.attr("data-pick"))).close(!0),o()):n.attr("data-clear")&&(v.clear().close(!0),o())})}v.$root.on("focusin",function(e){v.$root.removeClass(p.focused),n(v.$root[0],"selected",!1),e.stopPropagation()}),v.$root.on("mousedown click",function(t){var n=t.target;n!=v.$root.children()[0]&&(t.stopPropagation(),"mousedown"==t.type&&"input"!==angular.element(n)[0].tagName&&"OPTION"!=n.nodeName&&(t.preventDefault(),e.focus()))}),o(),n(v.$root[0],"hidden",!0)}function c(){var t=["string"==typeof f.hiddenPrefix?f.hiddenPrefix:"","string"==typeof f.hiddenSuffix?f.hiddenSuffix:"_submit"];v._hidden=angular.element('<input type=hidden name="'+t[0]+e.name+t[1]+'"id="'+t[0]+e.id+t[1]+'"'+(m.attr("data-value")||e.value?' value="'+v.get("select",f.formatSubmit)+'"':"")+">")[0],m.on("change."+g.id,function(){v._hidden.value=e.value?v.get("select",f.formatSubmit):""}).after(v._hidden)}function s(e){e.stopPropagation(),"focus"==e.type&&(v.$root.addClass(p.focused),n(v.$root[0],"selected",!0)),v.open()}if(!e)return t;var f;r?(f=r.defaults,angular.extend(f,i)):f=i||{};var p=t.klasses();angular.extend(p,f.klass);var g={id:e.id||"P"+Math.abs(~~(Math.random()*new Date))},m=angular.element(e),h=function(){return this.start()},v=h.prototype={constructor:h,$node:m,start:function(){return g&&g.start?v:(g.methods={},g.start=!0,g.open=!1,g.type=e.type,e.autofocus=e==document.activeElement,e.type="text",e.readOnly=!f.editable,e.id=e.id||g.id,v.component=new r(v,f),v.$root=angular.element(t._.node("div",u(),p.picker,'id="'+e.id+'_root"')),d(),f.formatSubmit&&c(),l(),f.container?angular.element(f.container).append(v.$root):m.after(v.$root),v.on({start:v.component.onStart,render:v.component.onRender,stop:v.component.onStop,open:v.component.onOpen,close:v.component.onClose,set:v.component.onSet}).on({start:f.onStart,render:f.onRender,stop:f.onStop,open:f.onOpen,close:f.onClose,set:f.onSet}),e.autofocus&&v.open(),v.trigger("start").trigger("render"))},render:function(e){return e?v.$root.html(u()):angular.element(v.$root[0].querySelectorAll("."+p.box)).html(v.component.nodes(g.open)),v.trigger("render")},stop:function(){return g.start?(v.close(),v._hidden&&v._hidden.parentNode.removeChild(v._hidden),v.$root.remove(),m.removeClass(p.input).removeData(o),setTimeout(function(){m.off("."+g.id)},0),e.type=g.type,e.readOnly=!1,v.trigger("stop"),g.methods={},g.start=!1,v):v},open:function(o){return g.open?v:(m.addClass(p.active),n(e,"expanded",!0),v.$root.addClass(p.opened),n(v.$root[0],"hidden",!1),o!==!1&&(g.open=!0,m.triggerHandler("focus"),angular.element(document.querySelectorAll("#"+g.id)).on("click focusin",function(t){var n=t.target;n!=e&&n!=document&&3!=t.which&&v.close(n===v.$root.children()[0])}),angular.element(document.querySelectorAll("#"+g.id)).on("keydown",function(n){var o=n.keyCode,r=v.component.key[o],a=n.target;27==o?v.close(!0):a!=e||!r&&13!=o?v.$root[0].contains(a)&&13==o&&(n.preventDefault(),a.click()):(n.preventDefault(),r?t._.trigger(v.component.key.go,v,[t._.trigger(r)]):angular.element(v.$root[0].querySelectorAll("."+p.highlighted)).hasClass(p.disabled)||v.set("select",v.component.item.highlight).close())})),v.trigger("open"))},close:function(t){return t&&(m.off("focus."+g.id),m.triggerHandler("focus"),setTimeout(function(){angular.element(document.querySelectorAll("#"+g.id)).on("focus",s)},0)),m.removeClass(p.active),n(e,"expanded",!1),v.$root.removeClass(p.opened+" "+p.focused),n(v.$root[0],"hidden",!0),n(v.$root[0],"selected",!1),g.open?(setTimeout(function(){g.open=!1},1e3),a.off("."+g.id),v.trigger("close")):v},clear:function(){return v.set("clear")},set:function(e,t,n){var o,r,a=angular.isObject(e),i=a?e:{};if(n=a&&angular.isObject(t)?t:n||{},e){a||(i[e]=t);for(o in i)r=i[o],o in v.component.item&&v.component.set(o,r,n),("select"==o||"clear"==o)&&(m[0].value="clear"==o?"":v.get(o,f.format),m.triggerHandler("change"));v.render()}return n.muted?v:v.trigger("set",i)},get:function(n,o){return n=n||"value",null!=g[n]?g[n]:"value"==n?e.value:n in v.component.item?"string"==typeof o?t._.trigger(v.component.formats.toString,v.component,[o,v.component.get(n)]):v.component.get(n):void 0},on:function(e,t){var n,o,r=angular.isObject(e),a=r?e:{};if(e){r||(a[e]=t);for(n in a)o=a[n],g.methods[n]=g.methods[n]||[],g.methods[n].push(o)}return v},off:function(){var e,t,n=arguments;for(e=0,namesCount=n.length;e<namesCount;e+=1)t=n[e],t in g.methods&&delete g.methods[t];return v},trigger:function(e,n){var o=g.methods[e];return o&&o.map(function(e){t._.trigger(e,v,[n])}),v}};return new h}function n(e,t,n){if(angular.isObject(t))for(var r in t)o(e,r,t[r]);else o(e,t,n)}function o(e,t,n){angular.element(e).attr(("role"==t?"":"aria-")+t,n)}function r(e,t){angular.isObject(e)||(e={attribute:t}),t="";for(var n in e){var o=("role"==n?"":"aria-")+n,r=e[n];t+=null==r?"":o+'="'+e[n]+'"'}return t}var a=angular.element(document);return t.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},t._={group:function(e){for(var n,o="",r=t._.trigger(e.min,e);r<=t._.trigger(e.max,e,[r]);r+=e.i)n=t._.trigger(e.item,e,[r]),o+=t._.node(e.node,n[0],n[1],n[2]);return o},node:function(t,n,o,r){return n?(n=e.isArray(n)?n.join(""):n,o=o?' class="'+o+'"':"",r=r?" "+r:"","<"+t+o+r+">"+n+"</"+t+">"):""},lead:function(e){return(10>e?"0":"")+e},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1&&this.isInteger(e.getDate())},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&e%1===0},ariaAttr:r},t.extend=function(e,n){angular.element.prototype[e]=function(o,r){var a=this.data(e);if("picker"==o)return a;if(a&&"string"==typeof o)return t._.trigger(a[o],a,[r]),this;for(var i=0;i<this.length;i++){var u=angular.element(this[i]);u.data(e)||new t(u[0],e,n,o)}},angular.element.prototype[e].defaults=n.defaults},t});