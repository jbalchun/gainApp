var app=angular.module("MyApp.maincontrol",["ionic","MyApp.services","ngStorage","ngCordova"]);app.controller("liftcontrol",["$scope","$ionicModal","$localStorage","$rootScope","$state","localStore","$ionicPopup","$ionicPopover","$ionicPlatform","$timeout","$ionicScrollDelegate",function(e,t,a,i,n,o,s,r,l,u,d){e.removeFlag=!1,e.blurFlag=!1,e.indexLift=0,e.userId="userX",e.focusIndex=0,e.date=new Date,e.liftDate=String(e.date).substring(4,15),e.workoutName={name:""},e.bodyWeight={wt:""},e.maxList={},e.lastList={};var m={},f={};e.todaysMaxs={},e.lastClickedRep={},e.goalMap=e.$storage.goalsMap,e.unpackedGoalsMap={},e.$storage=a,e.rangeMap={},e.rangeFlipFlag=!0,e.editingShow=0,e.lightHeavyMap=e.$storage.lightHeavyMap,e.nameList=e.$storage.nameList;var c=0,p=0,g=0;e.uniqueNameSetsMap={},e.resultsSourceNameMap={},e.resultsSource=[],e.notes={notes:""};var h=new Date;e.dateObj={Year:h.getFullYear(),Month:[h.getMonth()],Day:h.getDate()},e.dateList=[],e.calendar1=!1,e.infoFlag=1;var w={newlift:"",sets:"",id:""};e.auto={sets:0,reps:0},e.autoSetChoice=[{set1:3},{set1:4},{set1:5},{set1:6}],e.autoRepChoice=[3,5,6,8,10],e.liftCards=e.$storage.todaysLifts,r.fromTemplateUrl("pop/pop-date.html",{scope:e}).then(function(t){e.popover2=t}),e.closeKeyboard=function(){document.activeElement.blur(),document.activeElement.blur()},e.datePopup=function(t,a){if(document.body.classList.add("platform-ios"),e.dateType=a,"Day"==a){for(var i=[],n=1;31>=n;n++)i.push(n);e.dateList=i}else"Month"==a?e.dateList=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]:"Year"==a&&(e.dateList=["2015","2016","2017","2018","2019","2020"]);e.popover2.show(t)},e.addLift=function(){o.addLift("Select Lift",[{reps:"0",wt:"0"}]),d.$getByHandle("small").scrollBottom()},e.$on("loadedFromCalendar",function(t,a){e.liftCards=e.$storage.todaysLifts}),e.removeLift=function(){e.liftCards.length>1&&(e.removeFlag=!e.removeFlag)},e.uniqueSortReps=function(){e.sets=e.resultsLifts;var t=[];angular.forEach(e.resultsLifts,function(e,a){var i=[];angular.forEach(e.sets,function(e,t){i.push(e.reps)}),t.push(i)});var a=[];angular.forEach(t,function(e,t){var i=_.unique(e),n=i.sort(function(e,t){return e-t});a.push(n)}),e.uniqueSortedReps=a},e.populateBodyWeightResults=function(){var t=Number(e.bodyWeight.wt);if(t&&t>10){{var a=o.getMax("Body Weight",0);Math.abs(t)-_.max(a,function(e){return e.wt}).wt,Math.abs(t)-a.slice(-1)[0].wt}return e.maxList["Body Weight"]=Math.abs(Math.abs(t)-_.max(a,function(e){return e.wt}).wt),e.lastList["Body Weight"]=Math.abs(Math.abs(t)-a.slice(-1)[0].wt),{name:"Body Weight",reps:0,todaysMax:e.bodyWeight.wt,max:_.max(a,function(e){return e.wt}).wt,last:a.reverse().slice(-2)[0].wt}}e.maxList["Body Weight"]="None",e.lastList["Body Weight"]="None"},e.buildResultsObject=function(){var t=[];e.uniqueNameSetsMap={},angular.forEach(e.resultsLifts,function(a,i){var n=_.uniq(a.sets,function(e){return e.reps});e.uniqueNameSetsMap[a.name]=n,angular.forEach(n,function(i,n){t.push(e.populateResults(a.name,i.reps))})}),e.resultsSource=t,angular.forEach(e.resultsSource,function(t,a){e.resultsSourceNameMap[t.name+String(t.reps)]=t}),e.resultsSourceNameMap["Body Weight"]=e.populateBodyWeightResults()},e.populateResults=function(t,a){var i=[],n=[];e.lastClickedRep[t]=a,angular.forEach(e.resultsLifts,function(e,o){e.name==t&&angular.forEach(e.sets,function(t,o){Number(t.reps)==Number(a)&&(n.push({name:e.name,wt:Number(t.wt)}),i.push(Number(t.wt)))})});var s=_.max(n,function(e){return e.wt});e.todaysMaxs[t+String(a)]=s.wt;var r=o.getMax(t,a),l=o.getChartData(t,a,3);if(1==l.length)var u={wt:"None",date:l[0].date};else u=l[1];return console.log("lastItem",u),1==r.only1?(console.log("results preview lastone",{name:t,reps:a,todaysMax:e.todaysMaxs[t+String(a)],max:!1,last:0}),{name:t,reps:a,todaysMax:e.todaysMaxs[t+String(a)],max:0,last:0}):(-1e3>r||!r||r>1e3?e.maxList[t]="None":(e.maxList[t]=Math.abs(s.wt-Number(r.wt)),m[t]=s.wt&&s.wt-Number(r.wt)>0?0:1),-1e3>u||!u||u>1e3?e.lastList[t]="None":(e.lastList[t]=Math.abs(s.wt-Number(u.wt)),f[t]=s.wt&&s.wt-Number(u.wt)>0?0:1),console.log("results preview",{name:t,reps:a,todaysMax:e.todaysMaxs[t+String(a)],max:r,last:u}),{name:t,reps:a,todaysMax:e.todaysMaxs[t+String(a)],max:r,last:u})},e.changeNumber=function(t,a){if(e.editingNumber.id)if(1==e.editingNumber.id){if(a)return e.sets2[e.editingNumber.index].reps=t,c=t,void(e.editingShow={num:e.sets2[e.editingNumber.index].reps});c=e.sets2[e.editingNumber.index].reps+t,c>=0&&(e.sets2[e.editingNumber.index].reps=Number(e.sets2[e.editingNumber.index].reps)+t,e.editingShow={num:e.sets2[e.editingNumber.index].reps})}else if(2==e.editingNumber.id){if(a)return p=t,e.sets2[e.editingNumber.index].wt=t,void(e.editingShow={num:e.sets2[e.editingNumber.index].wt});p=e.sets2[e.editingNumber.index].wt+t,p>=0&&(e.sets2[e.editingNumber.index].wt=Number(e.sets2[e.editingNumber.index].wt)+t,e.editingShow={num:e.sets2[e.editingNumber.index].wt})}else if(3==e.editingNumber.id){var i=String(e.sets2[e.editingNumber.index].reps),n=Number(e.goalMapEdit[e.nameLift+i].wt);if(a)return g=t,void(e.goalMapEdit[e.nameLift+i]={wt:t});g=e.goalMapEdit[e.nameLift+i].wt+t,g>=0&&(e.goalMapEdit[e.nameLift+i]={wt:n+t})}},e.clearResults=function(){e.maxList={},e.lastList={},m={},f={},e.todaysMaxs={},e.lastClickedRep={}},e.onRelease=function(t,a){e.goalMapEdit[e.nameLift+t]={wt:e.rangeMap[a]}},e.selectNumber=function(t,a){1==a?(e.rangeFlipFlag=!0,e.editingShow={num:e.sets2[t].reps},e.editingNumber={index:t,id:a},e.wtSelectPress=t+String(a),console.log("main",e.wtSelectPress)):2==a&&(e.rangeFlipFlag=!1,e.editingShow={num:e.sets2[t].wt},e.editingNumber={index:t,id:a},e.wtSelectPress=t+String(a))},e.popAddSet=function(){var t=e.sets2.length-1;console.log(t),1==e.editingNumber.id?(e.rangeFlipFlag=!0,e.editingShow={num:e.sets2[t].reps},e.editingNumber.index=t,e.wtSelectPress=t+String(1)):(e.rangeFlipFlag=!0,e.editingShow={num:e.sets2[t].wt},e.editingNumber.index=t,e.wtSelectPress=t+String(2))},e.selectGoal=function(t){e.wtSelectPress=t+String(3),e.editingShow={num:e.goalMapEdit[e.nameLift+String(e.sets2[t].reps)]},e.editingNumber={index:t,id:3}},e.onReleaseNumber=function(){1==e.editingNumber.id?(c=e.editingShow.num,e.sets2[e.editingNumber.index].reps=e.editingShow.num):2==e.editingNumber.id&&(e.sets2[e.editingNumber.index].wt=e.editingShow.num,p=e.editingShow.num)},e.preset=function(t){var a=e.sets2.length-3;0>a&&(e.sets2.push(angular.copy(e.sets2[0])),a++,0>a&&e.sets2.push(angular.copy(e.sets2[0]))),1==t?angular.forEach(e.sets2,function(e,t){e.reps=5}):2==t?angular.forEach(e.sets2,function(e,t){e.reps=6}):3==t?angular.forEach(e.sets2,function(e,t){e.reps=8}):4==t&&angular.forEach(e.sets2,function(e,t){0==t&&(e.reps=5),1==t&&(e.reps=3),2==t&&(e.reps=1)}),e.sets2=_.first(e.sets2,3),e.liftCards[e.indexLift].sets=e.sets2},e.historyPop=function(t){if("Select Lift"!=e.liftCards[t].name&&(0!=e.liftCards[t].sets[0].reps||0!=e.liftCards[t].sets[0].wt)){e.histIndex=t;var a=[],i=e.liftCards[t].name;if(angular.forEach(e.liftCards[t].sets,function(e,t){a.push(e.reps)}),e.uniqueRepsHist=_.unique(a),e.maxList={},e.lastList={},angular.forEach(e.uniqueRepsHist,function(t,a){o.getMax(i,t).wt&&(e.maxList[t]=o.getMax(i,t).wt,e.lastList[t]=o.getChartData(i,t,3).reverse().slice(-1)[0].wt)}),0==e.maxList.length&&0==e.lastList.length){var n=s.show({title:"Lift History",subTitle:"No recorded numbers for selected lift and reps",scope:e,buttons:[{text:"<b >Done</b>",type:"button-dark",onTap:function(e){}}]});n.then(function(e){})}else{var n=s.show({templateUrl:"pop/pop-history.html",title:"Lift History",subTitle:"For selected lift and reps, this is your last weight lifted and max weight lifted",scope:e,buttons:[{text:"<b >Done</b>",type:"button-dark",onTap:function(e){}}]});n.then(function(e){})}}},r.fromTemplateUrl("pop/pop-liftnames.html",{scope:e}).then(function(t){e.popover=t}),e.namePopupSubmit=function(t){document.body.classList.add("platform-ios"),e.nameList=i.$storage.nameList,_.uniq(e.nameList,!1);var a=[];angular.forEach(e.nameList,function(t,i){""==t&&-1==a.indexOf("(No Name)")&&(e.nameList[i]="(No Name)"),a.push(e.nameList[i])}),e.nameList=_.uniq(a,!1),e.popover.show(t)},e.namePopupSelect=function(t){return"clear"==t?(e.nameFilter="Name",e.popover.hide(),void e.filter()):(e.workoutName.name=t,void e.popover.hide())},e.showConfirm=function(){var t=!1;if(angular.forEach(e.liftCards,function(e,a){"Select Lift"==e.name&&(t=!0)}),t){var a=s.confirm({title:'Remove or edit "Select Lift"'});a.then(function(e){})}return t?void 0:void e.openModal("none","none","none",5)},e.dateErrorPop=function(){s.show({title:"You already lifted today!",subTitle:"Slow down tiger! Only one workout per day! (otherwise our metrics get real messy). Delete today's lift from the calendar tab to re-enter",scope:e,buttons:[{text:"Cancel"},{text:"<b >Done</b>",type:"button-dark",onTap:function(e){}}]})},i.emailPop=function(){"heroku"==i.stateW&&winston.log("info",e.$storage.userId+", opened email");var t=s.show({title:"Like Gain Deck?",scope:i,templateUrl:"pop/pop-email.html",buttons:[{text:"<b>Done</b>",type:"button-dark",onTap:function(e){}}]});t.then(function(t){if("heroku"==i.stateW){if(i.email.email.length>3&&-1==i.email.email.indexOf("@")){winston.log("info",e.$storage.userId+" closed with no email");var a=Parse.Object.extend("Reddit"),n=new a;n.save({username:i.email.email,uid:i.$storage.userId}).then(function(e){})}else if(i.email.email.length>3){winston.log("info",e.$storage.userId+" closed with email"+i.email.email);var o=Parse.Object.extend("Email"),s=new o;s.save({address:i.email.email,uid:i.$storage.userId}).then(function(e){})}e.$broadcast("destroyEmail")}})},e.$on("destroyEmail",function(){u(function(){i.email.email=""},3e3)}),e.showInfo=function(){if("heroku"==i.stateW){winston.log("info",e.$storage.userId+", viewed home info");var t=new Date}var a=s.show({title:"New Workout",scope:e,templateUrl:"pop/pop-maininfo.html",buttons:[{text:"<b>Done</b>",type:"button-dark",onTap:function(e){}}]});a.then(function(a){if("heroku"==i.stateW){var n=new Date-t;winston.log("info",e.$storage.userId+", closed home info after"+n)}})},e.removeLiftRow=function(t){e.removeFlag&&e.liftCards.splice(t,1)},e.keyPressed=function(t,a){13==t.keyCode&&e.s()},e.clearLifts=function(){var t=s.show({title:"Clear Lifts?",subTitle:"Today's data will be removed",scope:e,buttons:[{text:"Cancel"},{text:"<b>Clear</b>",type:"button-dark",onTap:function(t){o.clearLifts(),e.liftCards=e.$storage.todaysLifts,d.scrollTop()}}]});t.then(function(e){})},e.submitWeight=function(){e.liftCards[e.indexLift].sets=e.sets2,e.closeModal("lift",0,2)},e.toggleGroup=function(t){e.shownGroup=e.isGroupShown(t)?null:t},e.isGroupShown=function(t){return e.shownGroup===t},e.addSet=function(t){(0!=e.liftCards[t].sets[0].reps||0!=e.liftCards[t].sets[0].wt)&&o.addSet(t)},e.removeSet=function(e){o.removeSet(e)},e.updateGoals=function(){o.updateGoals(e.goalMapEdit),e.goalMap=e.$storage.goalsMap,e.closeModal("none",0,4)},e.outRemove=function(){e.removeFlag&&(e.removeFlag=!e.removeFlag)},e.popEditingNumber=function(t,a){t!=e.editingShow.num&&(a?e.changeNumber(t,a):e.changeNumber(t)),e.editingNumber.id=2,e.wtSelectPress=e.editingNumber.index+"2",e.editingShow={num:e.sets2[e.editingNumber.index].wt}},t.fromTemplateUrl("modals/nav-liftselector.html",{id:"1",scope:e,backdropClickToClose:!1,animation:"slide-in-up"}).then(function(t){e.modal=t}),t.fromTemplateUrl("modals/nav-weightselector.html",{id:"2",scope:e,backdropClickToClose:!0,animation:"slide-in-up"}).then(function(t){e.modal2=t}),t.fromTemplateUrl("modals/nav-results.html",{id:"3",scope:e,backdropClickToClose:!0,animation:"slide-in-up"}).then(function(t){e.modal3=t}),t.fromTemplateUrl("modals/nav-goals.html",{id:"4",scope:e,backdropClickToClose:!0,animation:"slide-in-up"}).then(function(t){e.modal4=t}),t.fromTemplateUrl("modals/nav-confirm.html",{id:"5",scope:e,backdropClickToClose:!0,animation:"slide-in-up"}).then(function(t){e.modal5=t}),e.openModal=function(t,a,i,n,o){if("Select Lift"!=t||2!=n){e.lightHeavyMap["Select Lift"]="heavy";var s=function(){e.modal.show()};if(1==n)e.blurFlag=!0,window.cordova&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),e.$storage.selectedLiftNames=[],angular.forEach(e.liftCards,function(t,a){t.name&&e.$storage.selectedLiftNames.push(t.name)}),u(s(),0),e.$storage.editingLift={name:t,index:a};else if(2==n)e.blurFlag=!0,e.nameLift=t,e.indexLift=a,angular.forEach(e.$storage.liftData,function(a,i){a.name==t&&(e.weightRack=a.weight)}),e.focusIndex=1,e.sets2=e.liftCards[a].sets,e.editingNumber=e.sets2[0].reps,e.editingShow={num:0},o?e.selectNumber(i,2):e.selectNumber(i,1),e.modal2.show();else if(3==n)e.blurFlag=!0,e.populateBodyWeightResults(),e.buildResultsObject(),e.modal3.show();else if(4==n){if("Select Lift"==e.liftCards[a].name||0==e.liftCards[a].sets[0].reps&&0==e.liftCards[a].sets[0].wt)return;e.blurFlag=!0,e.nameLift=t,e.indexLift=a,e.focusIndex=i,e.goalMapEdit=angular.copy(e.goalMap),e.sets2=_.uniq(e.liftCards[a].sets,!1,function(e){return Number(e.reps)}),e.selectGoal(0),angular.forEach(e.$storage.liftData,function(a,i){a.name==t&&(e.weightRack=a.weight)}),angular.forEach(e.sets2,function(t,a){e.goalMapEdit[e.nameLift+t.reps]?e.rangeMap[a]=e.goalMapEdit[e.nameLift+t.reps].wt:(e.goalMapEdit[e.nameLift+t.reps]={wt:0},e.rangeMap[a]=0)}),e.modal4.show()}else e.blurFlag=!0,e.modal5.show()}},e.$on("modal.hidden",function(){var t=w.newLift,a=(w.sets,w.id);1==a?(window.cordova,"no change"==t&&"Select Lift"==e.liftCards[e.$storage.editingLift.index].name&&(e.liftName="Select Lift"),"no change"!=t&&(e.liftCards[e.$storage.editingLift.index].name=t.name,e.$storage.lightHeavyMap[t.name]=t.weight),o.buildKgMap(),e.kgMap=e.$storage.kgMap,u(function(){e.$broadcast("reset-liftselect")},500)):2==a||(3==a?u(function(){e.clearResults()},3e3):4==a||1==t&&(o.checkDate(e.liftDate)?e.dateErrorPop():(o.saveLift(e.liftDate,e.liftCards,e.workoutName,e.bodyWeight,e.notes),e.resultsLifts=e.liftCards,e.liftCards=e.$storage.todaysLifts,e.uniqueSortReps(),e.openModal("","","","3"),e.workoutName.name="",e.notes.notes="",e.bodyWeight.wt="",n.go("tab.calendar"))))}),e.closeModal=function(t,a,i){w={newLift:t,sets:a,id:i},e.blurFlag=!1,1==i?e.modal.hide():2==i?e.modal2.hide():3==i?e.modal3.hide():4==i?e.modal4.hide():e.modal5.hide()}}]);