var app=angular.module("MyApp.timercontrol",[]);app.controller("timercontrol",["$scope","$ionicPopup","$timeout","$rootScope","localStore","$ionicPlatform","$cordovaLocalNotification",function(e,t,n,o,r,a,i){e.rangeMin={min:1},e.rangeSec={sec:30},e.startStopFlag=!0,e.timerClear=!0,e.infoFlag=4,e.loopFlag=!1,e.startedAt="",e.$on("$ionicView.beforeEnter",function(t,n){if(!n.fromCache&&"tab.timer"==n.stateName){console.log("entering timer");var o=r.getStartTime(),a=r.getMillisecondsFromMinSec();if(0!==o){var i=new Date,s=i-o;if(a>s){var c=l(a-s),g=r.getStartMinSec();console.log(c),e.timerEnterSet(c.sec,c.min),e.rangeMin.min=g.min,e.rangeSec.sec=g.sec,console.log(e.rangeMin.min,e.rangeSec.sec),e.startStopFlag=!1,e.startStop()}}}}),a.on("resume",function(){console.log("resuming");r.getStartTime(),r.getMillisecondsFromMinSec(),new Date}),a.on("pause",function(){console.log("pausing")}),e.timerEnterSet=function(t,o){s(t,o),n(function(){s(t,o)},5),e.startStopFlag=!1};var s=function(e,t){o.minutes=t,o.seconds=e,console.log("minsecchange",o.minutes,o.seconds,t,e)};e.cycle=function(){e.loopFlag=!e.loopFlag,e.startStop()};e.timerPreset=function(t,o){c(t,o),n(function(){c(t,o)},5),e.startStopFlag=!0};var c=function(t,n){e.rangeMin.min=n,e.rangeSec.sec=t,e.$broadcast("timer-reset"),r.setStartTime(e.rangeMin.min,e.rangeSec.sec),e.minutes=n,e.seconds=t};e.upOneMin=function(){e.startStopFlag&&e.rangeMin.min<30&&(e.rangeMin.min=parseFloat(e.rangeMin.min)+1,e.$broadcast("timer-reset"),n(function(){e.$broadcast("timer-reset")},5))},e.downOneMin=function(){e.startStopFlag&&(e.rangeMin.min>0&&(e.rangeMin.min=parseFloat(e.rangeMin.min)-1,e.$broadcast("timer-reset")),n(function(){e.$broadcast("timer-reset")},5))},e.upOneSec=function(){e.startStopFlag&&(e.rangeSec.sec<59&&(e.rangeSec.sec=parseFloat(e.rangeSec.sec)+1,e.$broadcast("timer-reset")),n(function(){e.$broadcast("timer-reset")},5))},e.downOneSec=function(){e.rangeSec.sec&&(e.rangeSec>0&&(e.rangeSec.sec=parseFloat(e.rangeSec.sec)-1,e.$broadcast("timer-reset")),n(function(){e.$broadcast("timer-reset")},5))},e.onRelease=function(){if(console.log("working"),e.startStopFlag){console.log("working,",e.rangeSec.sec,e.rangeMin.min);var t=Number(e.rangeMin.min),n=Number(e.rangeSec.sec);e.timerPreset(n,t),e.$broadcast("timer-start")}},e.seconds1=function(){return Number(60*e.rangeMin.min)+Number(e.rangeSec.sec)};var l=function(e){console.log("whats milli,",e);var t=e/6e4;console.log("timedif",t);var n=t.toString();if(-1!==n.indexOf("."))var o=Number(n.slice(n.indexOf("."),n.length));else var o=0;console.log("secondsDec",o);var r=Math.floor(t),a=Math.floor(60*o);return{min:r,sec:a}};e.startStop=function(){if(e.startStopFlag)if(e.timerClear){e.$broadcast("timer-start"),r.setStartTime(e.rangeMin.min,e.rangeSec.sec);{var t=(new Date).getTime(),n=new Date(t+1e3*e.seconds+60*e.minutes*1e3),t=(new Date).getTime();new Date(t+1e4)}window.cordova&&i.schedule({at:n,message:"This is a message",title:"This is a title",sound:null}).then(function(){console.log("The notification has been set")}),e.timerClear=!1}else e.$broadcast("timer-resume");else e.$broadcast("timer-stop"),e.loopFlag&&(e.loopFlag=!1);e.startStopFlag=!e.startStopFlag},e.reset=function(){console.log(e.loopFlag),r.resetStartTime(),e.loopFlag&&(console.log("init"),e.loopFlag=!1,e.$broadcast("timer-reset")),e.timerClear===!1&&(e.$broadcast("timer-reset"),e.minutes=0,e.seconds=0,e.startStopFlag=!0)},e.finished=function(){e.startStopFlag=!0,r.resetStartTime();var n=t.alert({title:"Times up!",template:""});e.loopFlag&&(n.close(),e.$broadcast("timer-reset"),e.startStop()),n.then(function(e){})},e.timerToggle=function(){e.$broadcast("timer-stop")}}]);