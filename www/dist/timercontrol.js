var app=angular.module("MyApp.timercontrol",[]);app.controller("timercontrol",["$scope","$ionicPopup","$timeout","$rootScope",function(e,t,n,o){e.rangeMin={min:1},e.rangeSec={sec:30},e.startStopFlag=!0,e.timerClear=!0,e.stringMin=String(e.rangeMin),e.stringSec=String(e.rangeSec),e.infoFlag=4,e.loopFlag=!1,e.$watch("minutes",function(){e.stringMin=String(e.minutes),e.stringMin.length<2&&(e.stringMin="0"+String(e.minutes))}),e.$watch("seconds",function(){e.stringSec=String(e.seconds),e.stringSec.length<2&&(e.stringSec="0"+String(e.seconds))}),e.cycle=function(){e.loopFlag=!e.loopFlag,e.startStop()},e.showInfo=function(){"heroku"==o.stateW&&winston.log("info",e.$storage.userId+", viewed timer info at "+new Date);var n=t.show({title:"Timer",scope:e,templateUrl:"pop/pop-maininfo.html",buttons:[{text:"<b>Done</b>",type:"button-dark",onTap:function(e){}}]});n.then(function(t){"heroku"==o.stateW&&winston.log("info",e.$storage.userId+", closed timer info at "+new Date)})},e.timerPreset=function(t,o){console.log(t,o);var r=function(t,n){e.rangeMin.min=n,e.rangeSec.sec=t,e.$broadcast("timer-reset"),e.minutes=n,e.seconds=t};r(t,o),n(function(){r(t,o)},5),e.startStopFlag=!0},e.upOneMin=function(){e.startStopFlag&&e.rangeMin.min<30&&(e.rangeMin.min=parseFloat(e.rangeMin.min)+1,e.$broadcast("timer-reset"),n(function(){e.$broadcast("timer-reset")},5))},e.downOneMin=function(){e.startStopFlag&&(e.rangeMin.min>0&&(e.rangeMin.min=parseFloat(e.rangeMin.min)-1,e.$broadcast("timer-reset")),n(function(){e.$broadcast("timer-reset")},5))},e.upOneSec=function(){e.startStopFlag&&(e.rangeSec.sec<59&&(e.rangeSec.sec=parseFloat(e.rangeSec.sec)+1,e.$broadcast("timer-reset")),n(function(){e.$broadcast("timer-reset")},5))},e.downOneSec=function(){e.rangeSec.sec&&(e.rangeSec>0&&(e.rangeSec.sec=parseFloat(e.rangeSec.sec)-1,e.$broadcast("timer-reset")),n(function(){e.$broadcast("timer-reset")},5))},e.onRelease=function(){if(console.log("working"),e.startStopFlag){console.log("working,",e.rangeSec.sec,e.rangeMin.min);var t=Number(e.rangeMin.min),n=Number(e.rangeSec.sec);e.timerPreset(n,t)}},e.seconds1=function(){return Number(60*e.rangeMin.min)+Number(e.rangeSec.sec)},e.$on("$ionicView.beforeEnter",function(t,n){n.fromCache||"tab.timer"!=n.stateName||(console.log("got it timer"),e.startStopFlag=!0)}),e.startStop=function(){if(e.startStopFlag)if(e.timerClear){if(e.$broadcast("timer-start"),window.cordova){var t=(new Date).getTime(),n=new Date(t+1e3*e.seconds+60*e.minutes*1e3);cordova.plugins.notification.local.schedule({text:"Delayed Notification",at:n,led:"FF0000",sound:null})}e.timerClear=!1}else e.$broadcast("timer-resume");else e.$broadcast("timer-stop"),e.loopFlag&&(e.loopFlag=!1);e.startStopFlag=!e.startStopFlag},e.reset=function(){console.log(e.loopFlag),e.loopFlag&&(console.log("init"),e.loopFlag=!1,e.$broadcast("timer-reset")),0==e.timerClear&&(e.$broadcast("timer-reset"),e.minutes=0,e.seconds=0,e.startStopFlag=!0)},e.finished=function(){e.startStopFlag=!0;var n=t.alert({title:"Times up!",template:""});e.loopFlag&&(n.close(),e.$broadcast("timer-reset"),e.startStop()),n.then(function(e){})},e.timerToggle=function(){e.$broadcast("timer-stop")}}]);