var app=angular.module("MyApp.timercontrol",[]);app.controller("timercontrol",["$scope","$ionicPopup","$cordovaMedia","$timeout","$rootScope","localStore","$ionicPlatform","$ionicPopover","$cordovaLocalNotification",function(e,t,o,n,r,a,c,i,l){e.rangeMin={min:1},e.rangeSec={sec:30},e.startStopFlag=!0,e.timerClear=!0,e.infoFlag=4,e.loopFlag=!1,e.startedAt="",e.count=0,e.currentLoops=0;var s=11;e.selectedCycle=a.getSelectedCycle(),e.cycles=Array.apply(null,{length:s}).map(Number.call,Number),e.$on("$ionicView.beforeEnter",function(t,o){if(!o.fromCache&&"tab.timer"==o.stateName){console.log("entering timer");var n=a.getStartTime(),r=a.getMillisecondsFromMinSec();if(e.rangeMin={min:1},e.rangeSec={sec:30},0!==n){var c=new Date,i=c-n;if(r>i){var l=u(r-i),s=a.getStartMinSec();console.log(l),e.timerEnterSet(l.sec,l.min),e.rangeMin.min=s.min,e.rangeSec.sec=s.sec,console.log(e.rangeMin.min,e.rangeSec.sec),e.startStopFlag=!1,e.startStop()}}}}),c.on("resume",function(){console.log("resuming");var t=a.getStartTime(),o=a.getMillisecondsFromMinSec(),n=new Date,r=n-t;if(o>r){console.log("timer set to negative");var c=u(o-r),i=a.getStartMinSec();console.log(c),e.timerEnterSet(c.sec,c.min),e.rangeMin.min=i.min,e.rangeSec.sec=i.sec,console.log(e.rangeMin.min,e.rangeSec.sec),e.startStopFlag=!0,e.startStop()}else e.startStopFlag=!e.startStopFlag,e.$broadcast("timer-reset")}),c.on("pause",function(){console.log("pausing")}),e.timerEnterSet=function(t,o){g(t,o),n(function(){g(t,o)},5),e.startStopFlag=!1};var g=function(e,t){r.minutes=t,r.seconds=e};e.cycle=function(){e.loopFlag=!e.loopFlag,e.startStop()};e.timerPreset=function(t,o){m(t,o),n(function(){m(t,o)},5),e.startStopFlag=!0,e.timerClear=!0};var m=function(t,o){e.rangeMin.min=o,e.rangeSec.sec=t,e.$broadcast("timer-reset"),a.setStartTime(e.rangeMin.min,e.rangeSec.sec),e.minutes=o,e.seconds=t,e.timerClear=!0};e.upOneMin=function(){e.startStopFlag&&e.rangeMin.min<30&&(e.rangeMin.min=parseFloat(e.rangeMin.min)+1,e.$broadcast("timer-reset"),n(function(){e.$broadcast("timer-reset")},5))},e.downOneMin=function(){e.startStopFlag&&(e.rangeMin.min>0&&(e.rangeMin.min=parseFloat(e.rangeMin.min)-1,e.$broadcast("timer-reset")),n(function(){e.$broadcast("timer-reset")},5))},e.upOneSec=function(){e.startStopFlag&&(e.rangeSec.sec<59&&(e.rangeSec.sec=parseFloat(e.rangeSec.sec)+1,e.$broadcast("timer-reset")),n(function(){e.$broadcast("timer-reset")},5))},e.downOneSec=function(){e.rangeSec.sec&&(e.rangeSec.sec>0&&(e.rangeSec.sec=parseFloat(e.rangeSec.sec)-1,e.$broadcast("timer-reset")),n(function(){e.$broadcast("timer-reset")},5))},e.$on("timer-reset",function(){e.loopFlag||(p(),console.log("clearing"),e.timerClear=!0)}),e.$on("timer-stop",function(){console.log("clearing"),p(),e.timerClear=!0});var p=function(){window.cordova&&(console.log("clear"),l.cancelAll(function(){alert("done")},this))};e.onRelease=function(){if(console.log("working"),e.startStopFlag){console.log("working,",e.rangeSec.sec,e.rangeMin.min);var t=Number(e.rangeMin.min),o=Number(e.rangeSec.sec);e.timerPreset(o,t),e.$broadcast("timer-start")}},e.seconds1=function(){return Number(60*e.rangeMin.min)+Number(e.rangeSec.sec)};var u=function(e){console.log("whats milli,",e);var t=e/6e4;console.log("timedif",t);var o=t.toString();if(-1!==o.indexOf("."))var n=Number(o.slice(o.indexOf("."),o.length));else var n=0;console.log("secondsDec",n);var r=Math.floor(t),a=Math.floor(60*n);return{min:r,sec:a}};e.startStop=function(){if(e.count++,e.startStopFlag)if(e.timerClear){e.$broadcast("timer-start"),a.setStartTime(e.rangeMin.min,e.rangeSec.sec);var t=(new Date).getTime(),o=new Date(t+1e3*e.seconds+60*e.minutes*1e3);if(console.log("loo",e.loopFlag),window.cordova)if(e.loopFlag){console.log("hit it");for(var n=[],r=e.selectedCycle;r>0;r--){var c=r*(1e3*e.seconds+60*e.minutes*1e3);o=new Date(t+c),console.log("forloop",o,r,e.selectedCycle),n.push({at:o,id:e.count,title:"Time's Up!",text:"Cycle "+r+" of "+e.selectedCycle}),e.count++}l.schedule(n,e).then(function(){console.log("The notifications have been set")}),console.log(n)}else console.log("booking"),l.schedule({at:o,id:e.count,title:"Time's Up!"}).then(function(){console.log("The notification has been set")}),e.count++;e.timerClear=!1}else e.$broadcast("timer-resume");else e.$broadcast("timer-stop"),e.loopFlag&&(e.loopFlag=!1);e.startStopFlag=!e.startStopFlag},i.fromTemplateUrl("pop/pop-cycle.html",{scope:e}).then(function(t){e.popover=t}),e.cyclePop=function(t){document.body.classList.add("platform-ios"),console.log("cycles",e.cycles),e.popover.show(t)},e.cycleSelect=function(t){e.selectedCycle=t,a.setSelectedCycle(t),e.popover.hide()},e.reset=function(){console.log(e.loopFlag),a.resetStartTime(),e.loopFlag&&(e.loopFlag=!1,e.startStopFlag=!e.startStopFlag,e.$broadcast("timer-reset"),e.timerClear=!0),e.$broadcast("timer-reset"),e.minutes=0,e.seconds=0,e.startStopFlag=!0,e.timerClear=!0},e.finished=function(){console.log("finished"),e.startStopFlag=!0,a.resetStartTime(),e.$broadcast("timer-reset"),window.cordova&&d("audio/chime (2).mp3"),e.loopFlag?(e.currentLoops++,e.currentLoops<=e.selectedCycle?(n(function(){var o=t.alert({title:"Cycle "+e.currentLoops+" of "+e.selectedCycle+" complete"});n(function(){o.close()},600)},30),e.$broadcast("timer-reset"),e.currentLoops<e.selectedCycle&&e.startStop(),e.currentLoops==e.selectedCycle&&(e.loopFlag=!e.loopFlag)):(e.currentLoops=0,e.$broadcast("timer-reset"))):n(function(){e.alertPopup=t.alert({title:"Times up!"})},30)};var d=function(e){var t=new Media(e,null,null,f);t.play()},f=function(e){}}]);