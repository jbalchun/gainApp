var app=angular.module("MyApp.calendarcontrol",["ionic","MyApp.services","ngStorage"]);app.controller("calendarcontrol",["$scope","$ionicModal","parseFactory","$timeout","$ionicScrollDelegate","$rootScope","$localStorage","$state","localStore","$ionicPopup","$ionicPopover",function(t,a,e,o,n,r,i,l,s,c,f){t.dateObj={Year:"Year",Month:"Month",Day:"Day"},t.nameFilter="Name",t.liftName="Lift",t.tabTitle="Calendar",t.loading=!0,t.$on("clear-cal",function(){console.log("clearcal"),t.refreshCal()}),t.refreshCal=function(a){o(function(){t.loading=!1,t.$storage=i,t.workouts=t.$storage.mainObj.workouts,t.filterList=angular.copy(t.$storage.mainObj.workouts),t.searchQuery="",t.dateType="",t.today=new Date,t.$storage=i,t.nameList=t.$storage.mainObj.nameList,t.monthMap={Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12},t.calendar1=!0,t.infoFlag=2},100)},t.$on("$ionicView.afterEnter",function(a,e){(!e.fromCache&&"tab.calendar"==e.stateName||r.clearCal)&&t.refreshCal(),"tab.calendar"==e.stateName&&t.$storage.mainObj.justLoaded===!0&&(t.clearAll(),r.$storage.mainObj.justLoaded=!1)}),t.$on("calRefresh",function(){t.filterList=angular.copy(t.$storage.mainObj.workouts)}),t.toggleGroup=function(a){t.shownGroup=t.isGroupShown(a)?null:a},t.isGroupShown=function(a){return t.shownGroup===a},t.clearSearch=function(){t.searchQuery=""},t.isLiftDay=function(a){return a.length>2?!0:t.dateList.indexOf(2)>-1&&"Month"!=t.dateObj.Month?t.checkDayFiltered(a):t.dateList.indexOf(2)>-1&&"Month"==t.dateObj.Month?s.checkDay(a):void 0},t.checkDayFiltered=function(a){var e=!1;return angular.forEach(t.filterList,function(t,o){var n=Number(t.date.slice(3,6)),r=Number(a);n==r&&(e=!0)}),e},t.removeWorkout=function(a){t.trashFlag=!1;var e=c.confirm({title:"Remove this workout permanently?",buttons:[{text:"<b>Cancel</b>",type:"button-light",onTap:function(t){}},{text:"<b>Ok</b>",type:"button-dark",onTap:function(a){t.trashFlag=!0}}]});e.then(function(e){t.trashFlag&&(s.removeWorkout(a),t.filterList=angular.copy(t.$storage.mainObj.workouts),t.clearAll(),t.nameList=angular.copy(t.$storage.mainObj.nameList))})},f.fromTemplateUrl("pop/pop-date.html",{scope:t}).then(function(a){t.popover=a}),f.fromTemplateUrl("pop/pop-liftnames.html",{scope:t}).then(function(a){t.popover2=a}),t.showInfo=function(){if(o(function(){},3),"heroku"==r.stateW){var a=new Date;winston.log("info",t.$storage.mainObj.userId+", viewed calendar info")}var e=c.show({title:"Calendar",scope:t,templateUrl:"pop/pop-maininfo.html",buttons:[{text:"<b>Done</b>",type:"button-dark",onTap:function(t){}}]});e.then(function(e){if(!window.cordova){var o=new Date-a;winston.log("info",t.$storage.mainObj.userId+", closed calendar after"+o)}})},t.datePopup=function(a,e){if(document.body.classList.add("platform-ios"),t.dateType=e,"Day"==e){for(var o=[],n=1;31>=n;n++)o.push(n);t.dateList=o}else"Month"==e?t.dateList=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]:"Year"==e&&(t.dateList=["2015","2016","2017","2018","2019","2020"]);t.popover.show(a)},t.$on("cloud-load",function(){t.clearAll}),t.clearAll=function(){t.dateObj={Year:"Year",Month:"Month",Day:"Day"},t.nameFilter="Name",t.liftName="Lift",t.filterList=angular.copy(t.$storage.mainObj.workouts),n.$getByHandle("mainScroll").scrollTop()},t.namePopup=function(a){document.body.classList.add("platform-ios"),t.nameList=t.$storage.mainObj.nameList,_.uniq(t.nameList,!1);var e=[];angular.forEach(t.nameList,function(a,o){""==a&&-1==e.indexOf("(No Name)")&&(t.nameList[o]="(No Name)"),e.push(t.nameList[o])}),t.nameList=_.uniq(e,!1),t.popover2.show(a)},t.datePopupSelect=function(a,e){return"clear"==a?(t.dateObj[angular.copy(t.dateType)]=angular.copy(t.dateType),t.popover.hide(),void t.filter()):(t.dateObj[angular.copy(t.dateType)]=a,t.dateType="",t.popover.hide(),void t.filter())},t.namePopupSelect=function(a){return"clear"==a?(t.nameFilter="Name",t.popover2.hide(),void t.filter()):(t.nameFilter=a,t.popover2.hide(),void t.filter())},t.clearHold=function(){},t.filter=function(a){t.filterList=[];var e=!1,o=!1,r=!1,i=!1,l=!1,s=[],c=[],f=[],u=[],p=[];i="Name"!=t.nameFilter?!0:!1,e="Month"!=t.dateObj.Month?!0:!1,r="Year"!=t.dateObj.Year?!0:!1,o="Day"!=t.dateObj.Day?!0:!1,l="Lift"!=t.liftName?!0:!1;(i||e||r||o||l)&&"clear"!=a||(t.filterList=angular.copy(t.$storage.mainObj.workouts),n.$getByHandle("mainScroll").scrollTop()),angular.forEach(t.workouts,function(a,d){var m=new Date(a.date);l&&angular.forEach(a.lifts,function(e,o){e.name==t.liftName&&p.push(JSON.stringify(a))}),e&&m.getMonth()+1==t.monthMap[t.dateObj.Month]&&s.push(JSON.stringify(a)),o&&m.getDate()==t.dateObj.Day&&c.push(JSON.stringify(a)),r&&m.getFullYear()==String(t.dateObj.Year)&&f.push(JSON.stringify(a)),i&&(a.name==t.nameFilter&&u.push(JSON.stringify(a)),"(No Name)"==t.nameFilter&&""==a.name&&u.push(JSON.stringify(a))),n.$getByHandle("mainScroll").scrollTop()});var d=[{flag:o,array:c},{flag:e,array:s},{flag:r,array:f},{flag:i,array:u},{flag:l,array:p}],m=!1;if(angular.forEach(d,function(a,e){1!=a.flag||void 0!==a.array&&0!=a.array.length||(t.filterList=[],m=!0)}),!m){var h=[p,s,c,f,u],g=[];angular.forEach(h,function(t,a){t.length>=1&&g.push(t)});var y=[];y=g.length>1?_.intersection.apply(_,g):g[0],angular.forEach(y,function(a,e){t.filterList.push(JSON.parse(a))})}},t.loadLiftOptions=function(a){var e=c.show({title:"Load workout to editor?",scope:t,subTitle:'Editor content will be overwritten. "Load lifts only" only pulls in the lift names, "Load sets clean" loads all sets with weights set to 0',template:"<style>.popup { width:380px !important; }</style>",buttons:[{text:"Cancel"},{text:"<b>Load</b>",type:"button-dark",onTap:function(e){s.loadLiftFromCalendar(t.filterList[a]),r.$broadcast("loadedFromCalendar"),l.go("tab.posts")}},{text:"<b>Load lifts only</b>",type:"button-dark",onTap:function(e){s.loadLiftFromCalendar(t.filterList[a]),s.liftsOnly(t.filterList[a]),l.go("tab.posts")}},{text:"<b>Load sets clean</b>",type:"button-dark",onTap:function(e){s.loadLiftFromCalendar(t.filterList[a]),s.wipeWeights(),l.go("tab.posts")}}]});e.then(function(t){})},a.fromTemplateUrl("modals/nav-liftselector.html",{id:"1",scope:t,backdropClickToClose:!1,animation:"slide-in-up"}).then(function(a){t.modal=a}),t.openModal=function(){t.blurFlag=!0,t.modal.show()},t.closeModal=function(a){t.newLiftModal=a,t.blurFlag=!1,t.modal.hide()},t.$on("modal.hidden",function(){return"clear"==t.newLiftModal?(t.liftName="Lift",t.filter(),void o(function(){t.$broadcast("reset-liftselect")},500)):("no change"!=t.newLiftModal&&(t.liftName=t.newLiftModal.name,(t.liftName.length<2||"Lift"==t.liftName)&&(t.liftName="Lift"),t.filter()),void o(function(){t.$broadcast("reset-liftselect")},500))})}]);