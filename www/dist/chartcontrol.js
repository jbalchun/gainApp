var app=angular.module("MyApp.chartcontrol",["MyApp.services","ngStorage"]);app.controller("chartcontrol",["$scope","$localStorage","localStore","$ionicModal","$timeout","$rootScope","$ionicPopup","$ionicPopover","$state",function(e,t,a,l,i,o,r,s,n){e.liftName="Select Lift",e.chartTitle="Dummy Lift for xx reps",e.reps2="reps",e.reps={reps:0},e.reps3=[{reps:0}],e.repsChart={reps:0},e.labels=["January","February","March","April","May","June","July","asdf","asdf","asdf","asdf","asdf","asdf","July","asdf","asdf","asdf","asdf","asdf","asdf"],e.labels2=["January","February","March"],e.series=["Series A"],e.selectedLift="Barbell Bench",e.data=[[145,155,160,155,165,175,185,100,120,130,140,150,154,140,120,150,100,120,120,150]],e.weightSet=[[],[225,225,245,245,245,250,255,255,275]],e.bodyWeightData=[],e.bodyWtFlag=!0,e.dateSet=[1,2,3,4,5,6,7,8,9],e.firstDate="Start Date",e.lastDate="End Date",e.chartTable=!0,e.dateWeightObjectList=[],e.goalNum={wt:void 0},e.updateFlag=void 0,e.dateList=[],e.dateSetFull=[],e.firstDateFull="",e.spanSelect=0,e.selectedReps="Select Reps",e.$on("$ionicView.beforeEnter",function(t,a){a.fromCache&&"tab.charts"==a.stateName&&(console.log("onit"),e.chartTable=!0,c(!1),e.bodyWtFlag=!0,e.liftName="Select Lift",e.chartTitle="Dummy Lift",e.repsChart.reps="xx",e.selectedReps="Select Reps",e.dateSet=[1,2,3,4,5,6,7,8,9],e.dateSetFull=[1,2,3,4,5,6,7,8,9],e.firstDate="Start Date",e.lastDate="End Date",e.goalNum.wt=g(),e.weightSet=[[],[225,225,245,245,245,250,255,255,275]],e.weightSetFull=[[],[225,225,245,245,245,250,255,255,275]])}),e.infoFlag=3,e.chartCeiling=void 0,e.chartOptions={pointDotRadius:2,scaleLabel:"<%= value%>",scaleOverride:!1,scaleSteps:10,scaleStepWidth:10,scaleStartValue:100,datasetFill:!1};var c=function(t,a,l){if(t){e.chartOptions.scaleOverride=!0;var i=10*Math.round(l/10)-20;e.chartOptions.scaleStartValue=i;var o=10*Math.round(a/10)-i+10,r=o/10;e.chartOptions.scaleSteps=r}else e.chartOptions.scaleOverride=!1};e.getReps=function(){e.reps3=a.buildRepList(e.liftName),e.repSelect(0,e.chartTable,!0)},e.$on("closeKeyboard",function(t){e.updateGoal(e.repsChart.reps)}),e.showInfo=function(){if("heroku"==o.stateW){var t=new Date;winston.log("info",e.$storage.userId+", viewed data info")}var a=r.show({title:"Data",scope:e,templateUrl:"pop/pop-maininfo.html",buttons:[{text:"<b>Done</b>",type:"button-dark",onTap:function(e){}}]});a.then(function(a){if("heroku"==o.stateW){var l=new Date-t;winston.log("info",e.$storage.userId+", closed data after"+l)}})},e.keyPressed=function(e,t){},e.updateGoal=function(){if("Dummy Lift for xx reps"!=e.chartTitle){var t={};console.log("Bodywtflag",e.bodyWtFlag),e.bodyWtFlag?(t[e.liftName+String(e.repsGoal)]=e.goalNum.wt,a.updateGoals(t),e.repSelect(e.repsGoal,e.chartTable)):(t.BodyWt=e.goalNum.wt,a.updateGoals(t),e.updateFlag=1,e.chartBodyWeight(e.updateFlag))}},s.fromTemplateUrl("pop/pop-reps.html",{scope:e}).then(function(t){e.popover=t}),e.repPopup=function(t){document.body.classList.add("platform-ios"),e.popover.show(t)},e.repPopSelect=function(t){e.repsChart.reps=t,e.repsGoal=t,e.selectedReps=String(t+" reps"),e.repSelect(t,e.chartTable),e.popover.hide()},e.changeView=function(t,a){if(e.bodyWtFlag){if("Dummy Lift for xx reps"==e.chartTitle)return void(e.chartTable=t);e.repSelect(a,t)}else e.chartBodyWeight(1,!0);e.chartTable=t},e.repSelect=function(t,l,o){e.chartTitle=e.liftName,e.repsChart.reps=t,c(!1),e.chartOptions.scaleOverride=!1,"Select Lift"==e.liftName||"Select Reps"==e.selectedReps||o?(e.weightSet=[[],[225,225,245,245,245,250,255,255,275]],e.dateSet=[1,2,3,4,5,6,7,8,9],e.dateWeightObjectList=[],e.weightSetFull=angular.copy(e.weightSet),e.bodyWtFlag=!0):(e.weightSet=void 0,e.weightSet=[],e.dateSet=[],e.dateSetFull=[],i(function(){e.weightSet=a.getChartData(e.liftName,t,1),e.dateSetFull=a.getChartData(e.liftName,t,2);var l=[];angular.forEach(e.dateSetFull,function(t,a){l.push({date:t,wt:e.weightSet[0][a]})}),l.reverse(),e.weightSet=a.normalizeToWeeks(l,1),e.dateSetFull=a.normalizeToWeeks(l,2),e.dateList=a.normalizeToWeeks(l,3),e.firstDateFull=e.dateList[0],e.lastDate=e.dateList.slice(-1)[0],e.dateSet=angular.copy(e.dateSetFull),e.firstDate=angular.copy(e.firstDateFull);var i=[];if(g()){e.goalNum.wt=g(),angular.forEach(e.dateSetFull,function(t,a){i.push(e.goalNum.wt.wt)}),e.weightSet.push(i);var o=angular.copy(e.weightSet[0]),r=angular.copy(e.weightSet[1]);e.weightSet[0]=r,e.weightSet[1]=o,e.weightSetFull=angular.copy(e.weightSet)}else e.weightSet.unshift([]),e.goalNum.wt=void 0,e.weightSetFull=angular.copy(e.weightSet);e.dateWeightObjectList=[],e.dateWeightObjectList=l,e.bodyWtFlag=!0}))},e.selectTimespan=function(t){if("Dummy Lift for xx reps"!=e.chartTitle&&e.weightSet!=[[],[225,225,245,245,245,250,255,255,275]]){e.spanSelect=t;var a=Number(_.last(e.dateSetFull)),l=angular.copy(e.weightSetFull);if(t&&a>t){var i=a-t,o=new Date(e.firstDateFull);o.setDate(o.getDate()+7*i),e.firstDate=o.getMonth()+1+"/"+o.getDate()+"/"+o.getFullYear(),e.dateSet=_.last(e.dateSetFull,t),e.weightSet[0]=angular.copy(l[0].splice(l[0].length-t)),e.weightSet[1]=angular.copy(l[1].splice(l[1].length-t))}else e.dateSet=e.dateSetFull,e.firstDate=e.firstDateFull,e.weightSet[0]=angular.copy(l[0]),e.weightSet[1]=angular.copy(l[1])}},e.chartBodyWeight=function(t,l){if(e.firstDate="",e.lastDate="",e.liftName="Select Lift",e.selectedReps="Select Reps",e.bodyWtFlag||1==t&&!e.bodyWtFlag)1==t&&(e.updateFlag=0),e.weightSet=[],e.dateSet=[],i(function(){e.weightSet=a.getBodyWeightData(1),e.dateSetFull=a.getBodyWeightData(2),e.dateWeightObjectList=[],angular.forEach(e.dateSetFull,function(t,a){e.dateWeightObjectList.push({date:t,wt:e.weightSet[0][a]})}),e.dateWeightObjectList.reverse(),e.weightSet=a.normalizeToWeeks(e.dateWeightObjectList,1),e.dateSetFull=a.normalizeToWeeks(e.dateWeightObjectList,2),e.weightSetFull=angular.copy(e.weightSet),l||(e.bodyWtFlag=!1),e.chartTitle="Body Weight";var t=a.normalizeToWeeks(e.dateWeightObjectList,3);if(e.firstDateFull=t[0],e.lastDate=t.slice(-1)[0],e.dateSet=angular.copy(e.dateSetFull),e.firstDate=angular.copy(e.firstDateFull),g()){var i=[];e.goalNum.wt=g(),console.log("print get goal",e.goalNum.wt),angular.forEach(e.dateSetFull,function(t,a){i.push(e.goalNum.wt.wt)}),console.log("print goal array",i),e.weightSet.push(i);var o=angular.copy(e.weightSet[0]),r=angular.copy(e.weightSet[1]);e.weightSet[0]=r,e.weightSet[1]=o,e.weightSetFull=angular.copy(e.weightSet),console.log("print full array",e.weightSet);var s=_.max([_.max(e.weightSet[0]),_.max(e.weightSet[1])]),n=_.min([_.min(e.weightSet[0]),_.min(e.weightSet[1])]);c(!0,s,n)}else c(!0,_.max(e.weightSet[0]),_.min(e.weightSet[0])),e.weightSet.unshift([]),e.goalNum.wt=void 0,e.weightSetFull=angular.copy(e.weightSet)});else{if(void 0==e.repsGoal)return e.weightSet=[[],[225,225,245,245,245,250,255,255,275]],e.dateSet=[1,2,3,4,5,6,7,8,9],e.firstDate="Start Date",e.lastDate="End Date",e.liftName="Select Lift",e.selectedReps="Select Reps",e.chartOptions.scaleOverride=!1,e.bodyWtFlag=!0,e.goalNum.wt=g(),void(e.chartTitle="Dummy Lift for xx reps");e.repSelect(e.repsGoal,e.chartTable),e.bodyWtFlag=!0}};var g=function(){if(e.bodyWtFlag){var t=e.liftName+String(e.repsChart.reps);return a.getGoal(t)}return a.getGoal("BodyWt")};e.onClick=function(e,t){},l.fromTemplateUrl("modals/nav-liftselector.html",{id:"1",scope:e,backdropClickToClose:!1,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openModal=function(){e.blurFlag=!0,e.modal.show()},e.closeModal=function(t,a,l){e.blurFlag=!1,e.modal.hide(),"no change"!=t&&(e.liftName=t.name,e.selectedReps="Select Reps",i(function(){}),(e.liftName.length<2||"Select Lift"==e.liftName)&&(e.liftName="Select Lift"),e.getReps())}}]);