var app=angular.module("MyApp.chartcontrol",["MyApp.services","ngStorage"]);app.controller("chartcontrol",["$scope","localStore","$ionicModal","$timeout","$rootScope","$ionicPopup","$ionicPopover","$state",function(e,t,a,l,o,i,r,n){e.chartTable=0,e.liftName="Select Lift",e.chartTitle="Dummy Lift for xx reps",e.reps2="reps",e.reps={reps:0},e.reps3=[{reps:0}],e.repsChart={reps:0},e.labels=["January","February","March","April","May","June","July","asdf","asdf","asdf","asdf","asdf","asdf","July","asdf","asdf","asdf","asdf","asdf","asdf"],e.labels2=["January","February","March"],e.series=["Series A"],e.selectedLift="Barbell Bench",e.bodyWeightData=[],e.bodyWtFlag=!0,e.dateSet=[1,2,3,4,5,6,7,8,9],e.firstDate="Start Date",e.lastDate="End Date",e.dateWeightObjectList=[],e.goalNum={wt:void 0},e.updateFlag=void 0,e.dateList=[],e.dateSetFull=[],e.firstDateFull="",e.spanSelect=20,e.selectedReps="Select Reps",n.enterCount=0,e.loading=!0,e.refreshCharts=function(t){s(!1),e.bodyWtFlag=!0,e.dateWeightObjectList=[],e.liftName="Select Lift",e.chartTitle="Dummy Lift",e.repsChart.reps="xx",e.selectedReps="Select Reps",e.dateSet=[1,2,3,4,5,6,7,8,9],e.dateSetFull=[1,2,3,4,5,6,7,8,9],e.firstDate="Start Date",e.lastDate="End Date",e.goalNum.wt=c(),e.spanSelect=20,o.weightSet=[[],[225,225,245,245,245,250,255,255,275]],o.weightSetFull=[[],[225,225,245,245,245,250,255,255,275]],l(function(){e.spanSelect=20,console.log("reset")},1),g(),t&&n.go(n.current,{},{reload:!0}),e.selectTimespan(20)},e.$on("$ionicView.beforeEnter",function(t,a){console.log(e.$storage.mainObj.nameList),a.fromCache&&"tab.charts"===a.stateName?((0==e.chartTable||4==e.chartTable)&&(e.loading=!0),l(function(){e.refreshCharts(),e.loading=!1},50)):a.fromCache||"tab.charts"!==a.stateName||l(function(){e.refreshCharts(),e.loading=!1},300)}),e.infoFlag=3,e.chartCeiling=void 0,e.chartOptions={pointDotRadius:2,scaleLabel:"<%= value%>",scaleOverride:!1,scaleSteps:10,scaleStepWidth:10,scaleStartValue:100,datasetFill:!1};var s=function(t,a,l){if(t){e.chartOptions.scaleOverride=!0;var o=10*Math.round(l/10)-20;e.chartOptions.scaleStartValue=o;var i=10*Math.round(a/10)-o+10,r=i/10;e.chartOptions.scaleSteps=r}else e.chartOptions.scaleOverride=!1};e.getReps=function(){e.reps3=t.buildRepList(e.liftName),e.repSelect(0,e.chartTable,!0)},e.$on("closeKeyboard",function(t){e.updateGoal(e.repsChart.reps)}),e.showInfo=function(){if("heroku"==o.stateW)var t=new Date;var a=i.show({title:"Data",scope:e,templateUrl:"pop/pop-maininfo.html",buttons:[{text:"<b>Done</b>",type:"button-dark",onTap:function(e){}}]});a.then(function(e){if("heroku"==o.stateW){new Date-t}})},e.noDataPop=function(){var t=i.show({title:"Not Enough Data to Chart",subTitle:"We chart weekly max for a given lift and number of reps, so you need at least 2 weeks worth of this lift to see a trend. You can view your lifts in the table until then",scope:e,buttons:[{text:"<b>Close</b>",type:"button-dark",onTap:function(t){e.refreshCharts()}},{text:"<b>See Table</b>",type:"button-dark",onTap:function(t){e.repSelect(e.repsChart.reps,e.chartTable),e.chartTable=1}}]});t.then(function(e){})},e.keyPressed=function(e,t){},e.updateGoal=function(){if("Dummy Lift for xx reps"!=e.chartTitle){var a={};console.log("Bodywtflag",e.bodyWtFlag),e.bodyWtFlag?(a[e.liftName+String(e.repsGoal)]=e.goalNum.wt,t.updateGoals(a),e.repSelect(e.repsGoal,e.chartTable)):(a.BodyWt=e.goalNum.wt,t.updateGoals(a),e.updateFlag=1,e.chartBodyWeight(e.updateFlag))}},r.fromTemplateUrl("pop/pop-reps.html",{scope:e}).then(function(t){e.popover=t}),e.repPopup=function(t){"Select Lift"!=e.liftName&&(document.body.classList.add("platform-ios"),e.popover.show(t))},e.repPopSelect=function(t){e.repsChart.reps=t,e.repsGoal=t,e.selectedReps=String(t+" reps"),e.repSelect(t,e.chartTable),e.popover.hide()},e.changeView=function(t,a){if(console.log("switch"),e.selectTimespan(!1),console.log(e.chartTable),e.bodyWtFlag){if("Dummy Lift for xx reps"==e.chartTitle)return e.chartTable=t,void console.log(e.chartTable);e.repSelect(a,t)}else e.chartBodyWeight(1,!0);e.chartTable=t,console.log(e.chartTable)},e.repSelect=function(a,i,r){e.chartTitle=e.liftName,e.repsChart.reps=a,s(!1),e.chartOptions.scaleOverride=!1,"Select Lift"==e.liftName||"Select Reps"==e.selectedReps||r?(o.weightSet=[[],[225,225,245,245,245,250,255,255,275]],e.dateSet=[1,2,3,4,5,6,7,8,9],e.dateWeightObjectList=[],o.weightSetFull=angular.copy(e.weightSet),e.bodyWtFlag=!0,e.selectTimespan(20)):(o.weightSet=void 0,o.weightSet=[],e.dateSet=[],e.dateSetFull=[],l(function(){if(o.weightSet=t.getChartData(e.liftName,a,1),e.weightSet[0].length<=1&&0==e.chartTable)return void e.noDataPop();e.dateSetFull=t.getChartData(e.liftName,a,2);var l=[];angular.forEach(e.dateSetFull,function(t,a){l.push({date:t,wt:e.weightSet[0][a]})}),l.reverse(),o.weightSet=t.normalizeToWeeks(l,1),e.dateSetFull=t.normalizeToWeeks(l,2),e.dateList=t.normalizeToWeeks(l,3),e.firstDateFull=e.dateList[0],e.lastDate=e.dateList.slice(-1)[0],e.dateSet=angular.copy(e.dateSetFull),e.firstDate=angular.copy(e.firstDateFull);var i=[];if(c()){e.goalNum.wt=c(),angular.forEach(e.dateSetFull,function(t,a){i.push(e.goalNum.wt.wt)}),e.weightSet.push(i);var r=angular.copy(e.weightSet[0]),n=angular.copy(e.weightSet[1]);e.weightSet[0]=n,e.weightSet[1]=r,o.weightSetFull=angular.copy(e.weightSet)}else e.weightSet.unshift([]),e.goalNum.wt=void 0,o.weightSetFull=angular.copy(e.weightSet);e.dateWeightObjectList=[],e.dateWeightObjectList=l,e.bodyWtFlag=!0,e.loadAnalytics(),e.selectTimespan(20)}))},e.selectTimespan=function(t){if("Dummy Lift for xx reps"!=e.chartTitle&&o.weightSet!=[[],[225,225,245,245,245,250,255,255,275]]){if(("Select Lift"==e.liftName||"Select Reps"==e.selectedReps)&&e.bodyWtFlag)return void(e.bodyWtFlag&&(e.spanSelect=t));e.spanSelect=t;var a=Number(_.last(e.dateSetFull)),l=angular.copy(o.weightSetFull);if(t&&a>t){var i=a-t,r=new Date(e.firstDateFull);r.setDate(r.getDate()+7*i),e.firstDate=r.getMonth()+1+"/"+r.getDate()+"/"+r.getFullYear(),e.dateSet=_.last(e.dateSetFull,t),e.weightSet[0]=angular.copy(l[0].splice(l[0].length-t)),e.weightSet[1]=angular.copy(l[1].splice(l[1].length-t))}else e.dateSet=e.dateSetFull,e.firstDate=e.firstDateFull,e.weightSet[0]=angular.copy(l[0]),e.weightSet[1]=angular.copy(l[1]);e.loadAnalytics()}},e.chartBodyWeight=function(a,i){if(e.firstDate="",e.lastDate="",e.liftName="Select Lift",g(),e.selectedReps="Select Reps",e.selectTimespan(20),e.bodyWtFlag||1==a&&!e.bodyWtFlag)1==a&&(e.updateFlag=0),o.weightSet=[],e.dateSet=[],l(function(){if(o.weightSet=t.getBodyWeightData(1),e.dateSetFull=t.getBodyWeightData(2),e.weightSet[0].length<=1&&0==e.chartTable)return void e.noDataPop();e.dateWeightObjectList=[],angular.forEach(e.dateSetFull,function(t,a){e.dateWeightObjectList.push({date:t,wt:e.weightSet[0][a]})}),e.dateWeightObjectList.reverse(),o.weightSet=t.normalizeToWeeks(e.dateWeightObjectList,1),e.dateSetFull=t.normalizeToWeeks(e.dateWeightObjectList,2),o.weightSetFull=angular.copy(e.weightSet),i||(e.bodyWtFlag=!1),e.chartTitle="Body Weight";var a=t.normalizeToWeeks(e.dateWeightObjectList,3);if(e.firstDateFull=a[0],e.lastDate=a.slice(-1)[0],e.dateSet=angular.copy(e.dateSetFull),e.firstDate=angular.copy(e.firstDateFull),c()){var l=[];e.goalNum.wt=c(),console.log("print get goal",e.goalNum.wt),angular.forEach(e.dateSetFull,function(t,a){l.push(e.goalNum.wt.wt)}),console.log("print goal array",l),e.weightSet.push(l);var r=angular.copy(e.weightSet[0]),n=angular.copy(e.weightSet[1]);e.weightSet[0]=n,e.weightSet[1]=r,o.weightSetFull=angular.copy(e.weightSet),console.log("print full array",e.weightSet);var g=_.max([_.max(e.weightSet[0]),_.max(e.weightSet[1])]),h=_.min([_.min(e.weightSet[0]),_.min(e.weightSet[1])]);s(!0,g,h)}else s(!0,_.max(e.weightSet[0]),_.min(e.weightSet[0])),e.weightSet.unshift([]),e.goalNum.wt=void 0,o.weightSetFull=angular.copy(e.weightSet)});else{if(e.refreshCharts(),void 0==e.repsGoal)return o.weightSet=[[],[225,225,245,245,245,250,255,255,275]],e.dateSet=[1,2,3,4,5,6,7,8,9],e.firstDate="Start Date",e.lastDate="End Date",e.liftName="Select Lift",e.selectedReps="Select Reps",e.chartOptions.scaleOverride=!1,e.bodyWtFlag=!0,e.goalNum.wt=c(),void(e.chartTitle="Dummy Lift for xx reps");e.repSelect(e.repsGoal,0==e.chartTable),e.bodyWtFlag=!0}};var c=function(){if(e.bodyWtFlag){var a=e.liftName+String(e.repsChart.reps);return t.getGoal(a)}return t.getGoal("BodyWt")};e.onClick=function(e,t){},a.fromTemplateUrl("modals/nav-liftselector.html",{id:"1",scope:e,backdropClickToClose:!1,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openModal=function(){e.blurFlag=!0,e.modal.show()},e.closeModal=function(t,a,l){e.blurFlag=!1,e.newLiftModal=t,e.modal.hide()},e.$on("modal.hidden",function(){"no change"!=e.newLiftModal&&(e.liftName=e.newLiftModal.name,e.selectedReps="Select Reps",(e.liftName.length<2||"Select Lift"==e.liftName)&&(e.liftName="Select Lift"),e.getReps()),l(function(){e.$broadcast("reset-liftselect")},500)}),e.deltaWeeks="",e.deltaBody="",e.goalProject="",e.deltaWtBody="",e.showWeeks=!1,e.lastWt="",e.goalDiff="",e.loadAnalytics=function(){h(),d(),u()};var g=function(){e.deltaWeeks="",e.deltaBody="",e.goalProject="",e.deltaWtBody="",e.lastWt="",e.goalDiff="",e.goalProject=""},h=function(t){var a=t||o.weightSet[1],l=0,i=a.length-1;e.lastWt=o.weightSet[1][o.weightSet[1].length-1];for(var r=0;i>=r;r++)console.log("this ",a[r]," last ",a[r-1]),0!=r&&(l+=a[r]/a[r-1]-1);console.log("total",l,"count",i,l/i,l/i-1);var n=l/i*100;return t?n:void(e.deltaWeeks=n.toFixed(2))},d=function(){var t=e.deltaWeeks,a="";"undefined"!=typeof e.goalNum&&"undefined"!=typeof e.goalNum.wt&&"undefined"!=typeof e.goalNum.wt.wt&&(a=e.goalNum.wt.wt),console.log("goal",a);var l=o.weightSet[1][o.weightSet[1].length-1],i=a-l;0>t?(e.goalProject="Never",e.showWeeks=!1):l>=a||""==a?(e.goalProject="Reached or Empty",e.showWeeks=!1):(console.log("inc",1+t/100,"  "),e.showWeeks=!0,e.goalProject=Math.ceil(i/(l*(t/100))))},u=function(){var t=e.deltaWeeks,a=p(),l=h(a);e.deltaBody=l.toFixed(2),console.log("bod delta",a,l);var o=t/l;e.deltaWtBody=o.toFixed(4),e.bodyWtFlag||(e.deltaWtBody=1)},p=function(){var a=[];a=t.getBodyWeightData(1);var l=t.getBodyWeightData(2);if(a[0].length<=1&&0==e.chartTable)return void e.noDataPop();var o=[];if(angular.forEach(l,function(e,t){o.push({date:e,wt:a[0][t]})}),o.reverse(),a=t.normalizeToWeeks(o,1),l=t.normalizeToWeeks(o,2),console.log("bod",e.spanSelect,a[0]),e.spanSelect<a[0].length&&e.spanSelect){var i=a[0].slice(Math.max(a[0].length-e.spanSelect,1));return console.log("bodspan",e.spanSelect,i),i}return a[0]}}]);